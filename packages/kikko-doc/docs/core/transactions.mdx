---
sidebar_position: 2
slug: /core/transactions
---

# Transactions

:::info
During transaction all other queries that are not in transaction will be queued. To avoid
timeout for those queries make sure that your transactions run as fast as possible. We recommend running 
all time-consuming work before transaction start.
:::

## Running in transaction

```typescript
await runInTransaction(db, async (db) => {
  await runQuery(db, deleteFrom("comments"));
  await runQuery(db, deleteFrom("notes"));
});
```

A Transaction will rollback if any error is thrown by the code that is running in the scope of the transaction.

## Nesting

It also supports nesting:

```typescript
await runInTransaction(db, async (db) => {
  await runQuery(db, deleteFrom("comments"));
  await runInTransaction(db, async (db) => {
    await runQuery(db, deleteFrom("notes"));
  });
});
```

Nested transaction will be merged into the parent transaction. We plan to add support
for `SAVEPOINT` and `RELEASE` commands, so nested transaction will run in isolation.

## After transaction callbacks

You could also register a callback that will run once the transaction is finished or rolled back:

```typescript
await runInTransaction(db, async (db) => {
  await runQuery(db, deleteFrom("comments"));

  runAfterTransactionCommitted(db, () => {
    console.log("All comments are deleted!");
  });

  runAfterTransactionRollbacked(db, () => {
    console.log("Failed to delete comments");
  });
});
```

Note that callbacks will run **AFTER** transaction `COMMIT` or `ROLLBACK`. It especially helpful when you need
to notify other components that they can read from DB inserted values.

## Transaction modes

By default transaction will run in DEFERRED mode. If you need other modes use:

```typescript
// DEFERRED
runInDeferredTransaction();

// IMMEDIATE
runInImmediateTransaction();

// EXCLUSIVE
runInExclusiveTransaction();
```

For more information read https://www.sqlite.org/lang_transaction.html#deferred_immediate_and_exclusive_transactions
